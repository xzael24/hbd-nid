<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selamat Ulang Tahun!</title>
    <!-- Importing Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ffffff; /* White */
            --text-color: #e0e0e0;
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glow-color: rgba(255, 255, 255, 0.6);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Montserrat', sans-serif;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: var(--text-color);
            position: relative;
        }

        /* Astronomy Background Elements */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration, 2s) infinite ease-in-out;
            opacity: 0.8;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .meteor {
            position: absolute;
            top: -100px;
            width: 300px;
            height: 1px;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0) 100%);
            transform: rotate(-45deg);
            animation: shoooting-star 5s linear infinite;
            opacity: 0;
        }
        
        @keyframes shoooting-star {
            0% { transform: translateX(0) translateY(0) rotate(-45deg); opacity: 1; }
            20% { opacity: 0; }
            100% { transform: translateX(-100vw) translateY(100vh) rotate(-45deg); opacity: 0; }
        }

        /* Content Container */
        .content-container { 
            position: relative;
            z-index: 10;
            padding: 2rem;
            text-align: center;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            background: linear-gradient(45deg, #ffffff, #cfcfcf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
            text-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
            opacity: 0;
            animation: fadeTitle 2s ease-out forwards;
        }

        @keyframes fadeTitle {
            from { opacity: 0; transform: translateY(-20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .message {
            font-size: 1.3rem;
            line-height: 2;
            margin-bottom: 3rem;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            font-weight: 400;
        }

        /* Word Animation Class */
        .word {
            display: inline-block;
            opacity: 0;
            margin-right: 5px; /* Spacing between words */
            filter: blur(4px);
            animation: revealWord 1s forwards ease-out;
            transform: translateY(10px);
        }

        @keyframes revealWord {
            to { 
                opacity: 1; 
                filter: blur(0); 
                transform: translateY(0);
            }
        }

        /* Improved Primary Button */
        .btn {
            padding: 16px 40px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0; /* Hidden initially */
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            border-color: #fff;
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Fireworks Canvas */
        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        /* Welcome Overlay */
        #welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
        }

        #welcome-overlay .card {
            background: rgba(20, 20, 30, 0.6);
            backdrop-filter: blur(15px);
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            max-width: 500px;
            width: 90%;
        }

        #welcome-overlay h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            animation: none; 
            opacity: 1;
            background: none;
            -webkit-text-fill-color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        #welcome-overlay p {
            margin-bottom: 1.5rem;
            font-size: 1rem;
            color: #ccc;
            line-height: 1.5;
        }

        /* Updated Music Selection Overlay */
        .music-input-container {
            margin-bottom: 2rem;
            text-align: center;
        }

        .instruction {
            margin-bottom: 8px !important;
            font-size: 0.9rem;
            color: #bbb;
        }

        .youtube-input {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #fff;
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s;
        }

        .youtube-input:focus {
            outline: none;
            border-color: #fff;
            background: rgba(255,255,255,0.1);
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
        }

        .sub-instruction {
            font-size: 0.85rem !important;
            margin-bottom: 12px !important;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .default-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .btn-option {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: #ddd;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-option:hover {
            background: rgba(255,255,255,0.1);
            border-color: #fff;
            color: #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        .btn-start {
            padding: 14px 40px;
            background: #fff;
            color: #000;
            border: none;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-start:hover {
            transform: scale(1.05);
            background: #f0f0f0;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.6);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 { font-size: 2.5rem; margin-bottom: 1.5rem; }
            .message { font-size: 1rem; line-height: 1.6; margin-bottom: 2rem; }
            .content-container { padding: 1.5rem; width: 100%; }
            .btn { padding: 12px 30px; font-size: 0.9rem; width: 100%; max-width: 300px; }
            
            #welcome-overlay .card { padding: 1.5rem; width: 90%; max-height: 90vh; overflow-y: auto; }
            #welcome-overlay h1 { font-size: 1.8rem; }
            
            .default-options { flex-direction: column; width: 100%; } 
            .btn-option { width: 100%; padding: 10px; }
            
            .youtube-input { font-size: 0.9rem; padding: 10px; }
        }

        /* Small Phones */
        @media (max-width: 480px) {
            h1 { font-size: 2rem; }
            .message { font-size: 0.9rem; }
            #welcome-overlay p { font-size: 0.9rem; }
        }

        /* Landscape Mode Fix */
        @media (max-height: 500px) and (orientation: landscape) {
            .content-container {
                transform: scale(0.85); /* Proper scaling */
                padding: 0.5rem;
            }
            .message { margin-bottom: 0.5rem; font-size: 0.9rem; }
            h1 { margin-bottom: 0.5rem; font-size: 2rem; }
            #welcome-overlay .card { padding: 1rem; display: flex; flex-direction: column; justify-content: center; }
            .default-options { flex-direction: row; }
            .btn-option { width: auto; font-size: 0.8rem; }
            #welcome-overlay h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
        }
    </style>
</head>
<body>

    <!-- Audio Element (Empty initially) -->
    <audio id="bg-music" loop></audio>

    <!-- Star Background (Always visible) -->
    <div class="stars" id="stars-container"></div>
    <canvas id="fireworks-canvas"></canvas>

    <!-- 1. Music Selection Overlay -->
    <div id="welcome-overlay">
        <div class="card">
            <h1>Welcome, Nida</h1>
            <p>Seblum masuk, pilih lagu untuk nemenin km baca ini ya:</p>
            
            <div class="music-input-container">
                <p class="instruction">Tempel link YouTube lagu favoritmu di sini:</p>
                <input type="text" id="youtube-link" placeholder="Contoh: https://youtu.be/..." class="youtube-input">
                <p class="sub-instruction">Atau pakai default:</p>
                <div class="default-options">
                    <button class="btn-option" onclick="selectDefault('rayuan')">Rayuan Perempuan Gila</button>
                    <button class="btn-option" onclick="selectDefault('beranjak')">Beranjak Dewasa</button>
                    <button class="btn-option" onclick="selectDefault('jamrud')">Selamat Ulang Tahun</button>
                </div>
            </div>

            <button class="btn-start" onclick="enterSite()">Buka Ucapan âœ¨</button>
        </div>
    </div>

    <!-- 2. Main Content (Hidden initially) -->
    <div class="content-container" id="main-content" style="display: none; opacity: 0;">
        <h1>Happy Birthday</h1>
        <div class="message" id="birthday-message">
            Happy 19th birthday yaa.<br><br>
            Gila sih, kadang ak mikirâ€¦ km udah ngelewatin banyak hal yang nggak semua orang seumuran km kuat jalaninnya. Pasti banyak momen capek, bingung, ngerasa sendirian, tapi entah gimana km tetep jalan terus, kerenn km kk nid, ur little family must be proud of u.<br><br>
            Pokonya semoga di umur 19 ini km lebih sering nemuin hal hal kecil yang bikin km ngerasa tenang, lebih percaya sama diri km sendiri, dan pelan pelan jg sadar kalau semua perjuangan km sejauh ini nggak sia sia yh kk nid. Apa pun yang lagi km hadapin sekarang, ak harap km tau kalau km pantes dapet hal-hal baik.<br><br>
            Happy birthday yaa Nida Reyhanaâœ¨âœ¨
        </div>
        <button class="btn" onclick="startCelebration()">Nyalain kembang api disini nid ðŸŽ†</button>
        
        <!-- Skip Button (Visible during animation) -->
        <button id="skip-btn" onclick="skipAnimation()" style="display:none; position: absolute; bottom: 20px; right: 20px; padding: 8px 15px; background: rgba(255,255,255,0.1); color: #aaa; border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; font-size: 0.8rem; cursor: pointer;">Skip Animasi >></button>
    </div>

    <!-- Hidden YouTube Player Container -->
    <div id="player" style="display:none;"></div>

    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.10.0/dist/index.umd.js"></script>
    
    <script>
        // Load YouTube IFrame Player API code asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player;
        var selectedVideoId = 't7bT4V1G-c0'; // Default: Rayuan Perempuan Gila ID (example)

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '0',
                width: '0',
                videoId: selectedVideoId,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'loop': 1
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        }

        function onPlayerReady(event) {
            // Player is ready
        }

        // Helper to extract Video ID from URL
        function YouTubeGetID(url){
            url = url.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
            return (url[2] !== undefined) ? url[2].split(/[^0-9a-z_\-]/i)[0] : url[0];
        }

        let selectedLocalSong = null;

        function selectDefault(song) {
            // Updated to use LOCAL FILES as requested
            const localSongs = {
                'rayuan': 'song1.mp3',
                'beranjak': 'song2.mp3',
                'jamrud': 'song3.mp3'
            };
            
            // Clear YouTube input to avoid confusion
            document.getElementById('youtube-link').value = '';
            selectedLocalSong = localSongs[song];

            // Visual feedback
            document.querySelectorAll('.btn-option').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = '#ddd';
                btn.style.borderColor = 'rgba(255,255,255,0.2)';
            });
            event.target.style.background = 'rgba(255,255,255,0.2)';
            event.target.style.borderColor = '#fff';
            event.target.style.color = '#fff';
        }

        // 1. Enter Site Logic
        function enterSite() {
            const inputLink = document.getElementById('youtube-link').value;
            const audio = document.getElementById('bg-music');

            if (inputLink) {
                // Priority 1: User pasted a YouTube Link
                const extractedId = YouTubeGetID(inputLink);
                if (extractedId && player && player.loadVideoById) {
                    player.loadVideoById(extractedId);
                    player.setVolume(50);
                    player.playVideo();
                }
            } else if (selectedLocalSong) {
                // Priority 2: User selected a Default Song (Local MP3)
                audio.src = selectedLocalSong;
                audio.play().catch(e => console.log("Audio play failed:", e));
            } else {
                // Priority 3: No selection -> Default fallback to Song 1 (Local)
                audio.src = 'song1.mp3';
                audio.play().catch(e => console.log("Audio play failed:", e));
            }

            // Hide Overlay
            const overlay = document.getElementById('welcome-overlay');
            overlay.style.transition = 'opacity 1s ease';
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                startExperience(); // Start text animation
            }, 1000);
        }
        
        // Skip Animation Logic
        let animationTimeouts = [];

        function skipAnimation() {
            // Clear all pending timeouts
            animationTimeouts.forEach(timeout => clearTimeout(timeout));
            
            // Show all words immediately but SMOOTHLY
            const words = document.querySelectorAll('.word');
            words.forEach(word => {
                // If word is not yet visible, fade it in
                if (getComputedStyle(word).opacity == '0') {
                    word.style.transition = 'opacity 0.8s ease, filter 0.8s ease, transform 0.8s ease'; // Smooth transition
                    word.style.animation = 'none';
                    setTimeout(() => {
                        word.style.opacity = '1';
                        word.style.filter = 'blur(0)';
                        word.style.transform = 'translateY(0)';
                    }, 50); // Small delay to trigger transition
                }
            });

            // Show main button smoothly
            const btnElement = document.querySelector('.btn');
            btnElement.style.transition = 'opacity 1.5s ease 0.5s'; // Added delay
            btnElement.style.opacity = '1';
            btnElement.style.pointerEvents = 'auto';

            // Fade out Skip Button
            const skipBtn = document.getElementById('skip-btn');
            skipBtn.style.transition = 'opacity 0.5s ease';
            skipBtn.style.opacity = '0';
            setTimeout(() => { skipBtn.style.display = 'none'; }, 500);
        }

        // 2. Text Animation Logic
        function startExperience() {
            const content = document.getElementById('main-content');
            content.style.display = 'block';
            content.offsetHeight; 
            content.style.transition = 'opacity 2s ease';
            content.style.opacity = '1';

            // Show Skip Button
            document.getElementById('skip-btn').style.display = 'block';

            const msgElement = document.getElementById('birthday-message');
            const btnElement = document.querySelector('.btn');
            
            function splitText(el) {
                const nodes = Array.from(el.childNodes);
                el.innerHTML = ''; 
                let delayCounter = 0.7; 
                
                nodes.forEach(node => {
                    if (node.nodeType === 3) { 
                        const words = node.textContent.trim().split(/\s+/);
                        words.forEach(word => {
                            if (word.length > 0) {
                                const span = document.createElement('span');
                                span.textContent = word + ' ';
                                span.className = 'word';
                                span.style.animationDelay = `${delayCounter}s`;
                                el.appendChild(span);
                                delayCounter += 0.3; 
                            }
                        });
                    } else if (node.tagName === 'BR') {
                        el.appendChild(node.cloneNode());
                        delayCounter += 0.6; 
                    }
                });
                return delayCounter;
            }

            const totalTime = splitText(msgElement);

            // Store the timeout ID so we can clear it if skipped
            const timeoutId = setTimeout(() => {
                btnElement.style.transition = 'opacity 1s ease-in';
                btnElement.style.opacity = '1';
                btnElement.style.pointerEvents = 'auto'; 
                document.getElementById('skip-btn').style.display = 'none'; // Auto hide skip when done
            }, totalTime * 1000);
            
            animationTimeouts.push(timeoutId);
        }

        // 3. Stars & Meteor Logic
        const starsContainer = document.getElementById('stars-container');
        const starCount = 200;

        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 2 + 1;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
            starsContainer.appendChild(star);
        }

        function createMeteor() {
            const meteor = document.createElement('div');
            meteor.className = 'meteor';
            meteor.style.left = `${Math.random() * 100}vw`;
            meteor.style.top = `${Math.random() * 50}vh`; 
            meteor.style.animationDuration = `${Math.random() * 2 + 3}s`;
            starsContainer.appendChild(meteor);
            setTimeout(() => { meteor.remove(); }, 5000);
        }
        setInterval(createMeteor, 2000);

        // 4. Fireworks & Celebration
        const container = document.getElementById('fireworks-canvas');
        const fireworks = new Fireworks.default(container, {
            autoresize: true, opacity: 0.5, acceleration: 1.05, friction: 0.97, gravity: 1.5,
            particles: 50, traceLength: 3, traceSpeed: 10, explosion: 5, intensity: 30, flickering: 50,
            lineStyle: 'round', hue: { min: 0, max: 360 }, delay: { min: 30, max: 60 },
            rocketsPoint: { min: 50, max: 50 },
            lineWidth: { explosion: { min: 1, max: 3 }, trace: { min: 1, max: 2 } },
            brightness: { min: 50, max: 80 }, decay: { min: 0.015, max: 0.03 },
            mouse: { click: false, move: false, max: 1 }
        });

        let isCelebrating = false;

        function startCelebration() {
            if (!isCelebrating) {
                fireworks.start();
                const btn = document.querySelector('.btn');
                btn.textContent = "Jangan lupa make a wish yaa nid âœ¨";
                btn.style.opacity = '0.7';
                btn.style.border = 'none';
                btn.style.cursor = 'default';
                isCelebrating = true;
            }
        }
    </script>
</body>
</html>
